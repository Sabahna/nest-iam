generator client {
  provider = "prisma-client-js"
  output   = "./generated/client2"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model ScopeNoSql {
  id     String            @id @default(auto()) @map("_id") @db.ObjectId
  name   String            @unique
  desc   String?
  scopes PermissionNoSql[]

  @@index([id])
  @@map("scope")
}

model ResourceNoSql {
  id          String            @id @default(auto()) @map("_id") @db.ObjectId
  name        String            @unique
  desc        String?
  permissions PermissionNoSql[]

  @@index([id])
  @@map("resource")
}

model PermissionNoSql {
  id          String                   @id @default(auto()) @map("_id") @db.ObjectId
  title       String?
  name        String                   @unique
  desc        String?
  resource    ResourceNoSql            @relation(fields: [resource_id], references: [id], onDelete: Cascade)
  resource_id String                   @db.ObjectId
  scope       ScopeNoSql               @relation(fields: [scope_id], references: [id], onDelete: Cascade)
  scope_id    String                   @db.ObjectId
  parent      RelatedPermissionNoSql[] @relation("children")
  children    RelatedPermissionNoSql[] @relation("parent")

  @@index([id, resource_id, scope_id])
  @@map("permission")
}

model RelatedPermissionNoSql {
  id        String          @id @default(auto()) @map("_id") @db.ObjectId
  parent    PermissionNoSql @relation("parent", fields: [parent_id], references: [id], onDelete: Cascade)
  parent_id String          @db.ObjectId
  child     PermissionNoSql @relation("children", fields: [child_id], references: [id], onDelete: Cascade)
  child_id  String          @db.ObjectId

  @@index([parent_id, child_id])
  @@map("related_permission")
}
